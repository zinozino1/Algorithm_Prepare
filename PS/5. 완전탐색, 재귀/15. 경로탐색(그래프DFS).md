```py


# 내 풀이
-> o(n^3) 개노답 코드

import sys
import itertools as it

input = sys.stdin.readline

def sol():
  n,m = map(int, input().split())
  g = [[0] * n for _ in range(n)]
  cnt = 0
  tmpN = 0
  for i in range(m):
    a,b = map(int, input().split())
    g[a-1][b-1] = 1

  for i in range(1,n-1):
    for tmp in it.permutations(list(range(2, n)),i):
      curr = list(tmp)
      curr.append(n)
      curr.insert(0,1)
      tmpN += 1
      for i in range(len(curr)-1):
        if g[curr[i]-1][curr[i+1]-1] != 1:
          cnt+=1
          break

  print(tmpN-cnt)
sol()

# 개선 -> 가지치기를 못해서 이것도 시간 오래걸림

import sys

input = sys.stdin.readline
cnt = 0

def isDone(res,g,n):
  curr = list(map(int, res))
  curr.append(n)
  curr.insert(0,1)
  print(curr)
  for i in range(len(curr)-1):
    if g[curr[i]][curr[i+1]] != 1:
      return False
  return True

def dfs(L, res,tmp,check,g,n):
  global cnt
  if L == len(tmp):
    #print(res)
    pass
  else:
    for i in range(len(tmp)):
      if check[i] == 0:
        check[i] = 1
        res += str(tmp[i])
        # if g[tmp[L-1]][tmp[i]] != 1 and L > 0:
        #   res = res[:len(res)-1]
        #   return
        if isDone(res,g,n):
          cnt+=1

        dfs(L+1, res, tmp,check,g,n)
        check[i] = 0
        res = res[:len(res)-1]

def sol():
  n,m = map(int, input().split())
  # 인덱스 활용하기 위해 n+1
  g = [[0] * (n+1) for _ in range(n+1)]
  for i in range(m):
    a,b = map(int, input().split())
    g[a][b] = 1
  tmp = list(range(2,n))
  check = [0] * len(tmp)
  res = ''
  dfs(0, res,tmp,check,g,n)
  print(cnt)
sol()


```
